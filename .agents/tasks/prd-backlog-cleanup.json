{
  "version": 1,
  "project": "Backlog Cleanup & Technical Debt",
  "overview": "Complete the idea management feature set, implement critical security measures, fix performance bottlenecks, and address code quality issues to achieve production readiness.",
  "goals": [
    "Complete all CRUD operations for ideas (view details, add feedback, edit, delete)",
    "Implement authentication to secure all API endpoints",
    "Fix N+1 query performance issues in tag fetching and creation",
    "Comprehensive refactoring to eliminate code duplication and monolithic components",
    "Add search and filtering capabilities for content discovery",
    "Implement data portability with import/export functionality"
  ],
  "nonGoals": [
    "Multi-user authentication (single-user API key approach only)",
    "Real-time collaboration features",
    "Automatic prioritization or ranking of ideas",
    "Social sharing or public access",
    "Advanced conflict resolution for import (basic validation only)"
  ],
  "successMetrics": [
    "All API endpoints secured with authentication",
    "N+1 queries eliminated (max 2 queries per endpoint)",
    "Code duplication reduced by 80% (measured by lines of duplicated code)",
    "Search returns results in under 200ms with 1000+ items",
    "All quality gates pass: bun test, bun run lint, bun run typecheck, bun run build, bun test:e2e",
    "Test coverage minimum 80%"
  ],
  "openQuestions": [
    "Should API key be stored in .env file or require user input via UI?",
    "Import merge strategy: skip conflicts vs overwrite vs prompt user?"
  ],
  "stack": {
    "framework": "React 19 with Bun",
    "hosting": "Static file hosting",
    "database": "SQLite (bun:sqlite)",
    "auth": "API key authentication (single-user, X-API-Key header)",
    "testing": "Vitest with Bun, Playwright for E2E",
    "validation": "zod for runtime schema validation"
  },
  "routes": [
    {
      "path": "/ideas/:id",
      "name": "Idea Detail",
      "purpose": "View idea details with feedback, add/edit feedback, edit idea, delete idea"
    },
    {
      "path": "/ideas/:id/edit",
      "name": "Edit Idea",
      "purpose": "Edit idea name, description, tags, and move to different topic"
    },
    {
      "path": "/search",
      "name": "Search",
      "purpose": "Global text search with tag and rating filters, URL persistence"
    },
    {
      "path": "/settings",
      "name": "Settings",
      "purpose": "Configure API key, data export/import"
    },
    {
      "path": "/api/ideas/:id/feedback",
      "name": "Idea Feedback API",
      "purpose": "POST to create/update feedback (rating 1-5, notes)"
    },
    {
      "path": "/api/ideas/:id",
      "name": "Update/Delete Idea API",
      "purpose": "PUT to edit idea, DELETE to soft delete idea"
    },
    {
      "path": "/api/search",
      "name": "Search API",
      "purpose": "GET with query params for text, tags, rating filters"
    },
    {
      "path": "/api/export",
      "name": "Export API",
      "purpose": "GET to download all data as JSON"
    },
    {
      "path": "/api/import",
      "name": "Import API",
      "purpose": "POST to upload and validate JSON, import data"
    }
  ],
  "uiNotes": [
    "Authentication: API key input in settings page, stored in localStorage, sent as X-API-Key header",
    "Idea detail page: Show rating as interactive stars (1-5), textarea for notes (max 500 chars)",
    "Search page: Persistent search bar, tag filter chips (multi-select), rating dropdown, results count",
    "Export: Button in sidebar, triggers file download with timestamp in filename",
    "Import: File upload with drag-and-drop, validation errors shown inline, success summary",
    "Refactored components: Shared Sidebar, Layout wrapper, TagInput hook, StarRating component"
  ],
  "dataModel": [
    {
      "entity": "Feedback",
      "fields": [
        "id (primary key)",
        "ideaId (foreign key)",
        "rating (integer, 1-5, required)",
        "notes (text, optional, max 500 chars)",
        "createdAt (timestamp)",
        "updatedAt (timestamp)"
      ]
    },
    {
      "entity": "Idea",
      "fields": [
        "id (primary key)",
        "topicId (foreign key)",
        "name (text, required, max 200 chars)",
        "description (text, optional, max 5000 chars)",
        "isArchived (boolean, default false)",
        "createdAt (timestamp)",
        "updatedAt (timestamp)"
      ]
    },
    {
      "entity": "APIKey",
      "fields": [
        "key (string, stored in .env or localStorage)",
        "createdAt (timestamp for rotation tracking)"
      ]
    },
    {
      "entity": "Export/Import Format",
      "fields": [
        "version (integer)",
        "exportedAt (ISO timestamp)",
        "topics (array with tags)",
        "ideas (array with tags, feedback, topicId)"
      ]
    }
  ],
  "importFormat": {
    "description": "JSON export/import format for data portability",
    "example": {
      "version": 1,
      "exportedAt": "2026-01-20T00:00:00Z",
      "topics": [
        {
          "id": "uuid",
          "name": "Topic Name",
          "description": "Description text",
          "isArchived": false,
          "tags": ["tag1", "tag2"],
          "createdAt": "2026-01-20T00:00:00Z",
          "updatedAt": "2026-01-20T00:00:00Z"
        }
      ],
      "ideas": [
        {
          "id": "uuid",
          "topicId": "topic-uuid",
          "name": "Idea Name",
          "description": "Description text",
          "isArchived": false,
          "tags": ["tag1"],
          "feedback": {
            "rating": 4,
            "notes": "Optional notes"
          },
          "createdAt": "2026-01-20T00:00:00Z",
          "updatedAt": "2026-01-20T00:00:00Z"
        }
      ]
    }
  },
  "rules": [
    "API key required for all API endpoints (return 401 if missing/invalid)",
    "Feedback rating must be between 1 and 5 (validated with zod)",
    "Feedback notes max 500 characters (validated with zod)",
    "Search is case-insensitive and searches name + description fields",
    "Tag filter uses AND logic (show items matching ALL selected tags)",
    "Rating filter shows ideas >= selected threshold",
    "Import validates all required fields before inserting any data",
    "Import skips items with duplicate IDs (logs warning)",
    "Import returns detailed error message if validation fails",
    "Permanent delete of test cleanup endpoint in production builds",
    "All new components must use shared Sidebar/Layout components",
    "Tag input must use useTagInput hook (no duplicated logic)",
    "All API responses must include proper error messages (no stack traces)"
  ],
  "qualityGates": [
    "bun test",
    "bun test:e2e",
    "bun run lint",
    "bun run typecheck",
    "bun run build"
  ],
  "stories": [
    {
      "id": "US-001",
      "title": "Implement API key authentication middleware",
      "status": "done",
      "dependsOn": [],
      "description": "As a developer, I want API key authentication so that all endpoints are secure from unauthorized access.",
      "acceptanceCriteria": [
        "Create authentication middleware that validates X-API-Key header",
        "Store valid API key in .env file (API_KEY environment variable)",
        "Apply middleware to all API endpoints except /api/hello (for health checks)",
        "Return 401 Unauthorized if API key missing or invalid",
        "Remove /api/test/cleanup endpoint from production builds completely",
        "Example: Valid request with X-API-Key header -> returns data normally",
        "Negative case: Request without X-API-Key -> returns 401 with error message",
        "Negative case: Request with invalid X-API-Key -> returns 401",
        "Middleware added to src/lib/auth.ts",
        "bun test passes with new authentication tests",
        "bun run build succeeds",
        "bun run typecheck passes"
      ],
      "startedAt": "2026-01-20T11:48:29.391259+00:00",
      "completedAt": "2026-01-20T12:11:08.372604+00:00",
      "updatedAt": "2026-01-20T12:11:08.371526+00:00"
    },
    {
      "id": "US-002",
      "title": "View idea details with feedback display",
      "status": "in_progress",
      "dependsOn": ["US-001"],
      "description": "As a user, I want to view an idea's details and see its feedback rating and notes so that I can evaluate the idea.",
      "acceptanceCriteria": [
        "Update /ideas/:id route to display full idea details",
        "Show idea name (h1), description (paragraph), tags (badge pills)",
        "Show parent topic link with topic name",
        "Display feedback section with rating as interactive stars (1-5)",
        "Display feedback notes if present (paragraph)",
        "Show 'No feedback yet' message if feedback is missing",
        "Add 'Add Feedback' button if no feedback exists",
        "Add 'Edit Feedback' button if feedback exists",
        "Add 'Edit Idea' button linking to /ideas/:id/edit",
        "Add 'Delete Idea' button with confirmation modal",
        "Show creation and update timestamps",
        "Example: Idea with 4-star rating shows 4 filled stars, 1 empty star",
        "Example: Idea with notes shows notes text below rating",
        "Negative case: Navigating to archived idea returns 404",
        "Negative case: Navigating to idea with archived parent topic returns 404",
        "bun test passes, bun run lint passes, bun run typecheck passes"
      ],
      "startedAt": "2026-01-20T12:11:12.087600+00:00",
      "completedAt": null,
      "updatedAt": "2026-01-20T12:11:12.089084+00:00"
    },
    {
      "id": "US-003",
      "title": "Add feedback API endpoint with validation",
      "status": "open",
      "dependsOn": ["US-001"],
      "description": "As a developer, I want an API endpoint to create and update feedback so that users can rate ideas.",
      "acceptanceCriteria": [
        "Create POST /api/ideas/:id/feedback endpoint",
        "Validate request body with zod schema: { rating: number (1-5), notes?: string (max 500) }",
        "Check if idea exists and is not archived (404 if not found)",
        "Check if parent topic is not archived (404 if topic archived)",
        "If feedback exists for idea, update rating and notes",
        "If feedback doesn't exist, insert new feedback row",
        "Update feedback.updatedAt timestamp",
        "Return created/updated feedback with id, rating, notes, timestamps",
        "Require valid API key (X-API-Key header)",
        "Example: POST with rating 5 and notes 'Great idea!' -> creates feedback",
        "Negative case: Rating 6 -> returns 400 with validation error",
        "Negative case: Notes 600 chars -> returns 400 with max length error",
        "Negative case: Invalid idea ID -> returns 404",
        "Add 5 tests for feedback creation/update/validation",
        "bun test passes, bun run typecheck passes"
      ]
    },
    {
      "id": "US-004",
      "title": "Add feedback form UI component",
      "status": "open",
      "dependsOn": ["US-002", "US-003"],
      "description": "As a user, I want to add or edit feedback with an interactive form so that I can rate and annotate ideas.",
      "acceptanceCriteria": [
        "Create FeedbackForm component with star rating input",
        "Stars are clickable (1-5) with visual feedback (hover, active states)",
        "Selected rating stored in state, displayed as filled stars",
        "Unselected stars displayed as empty/outlined stars",
        "Textarea for notes with character counter (max 500)",
        "Validation: Rating is required, show error if not selected",
        "Validation: Notes max 500 chars, show counter and error if exceeded",
        "Submit button calls POST /api/ideas/:id/feedback",
        "Send X-API-Key header from localStorage",
        "On success: Refresh idea details to show updated feedback",
        "On error: Display error message from API",
        "Loading state during API call (disable submit button)",
        "Pre-fill form with existing feedback if editing (rating + notes)",
        "Example: Click 4th star -> rating=4, 4 stars filled",
        "Example: Type notes -> counter shows '45/500'",
        "Negative case: Submit without rating -> 'Rating is required' error",
        "Negative case: Type 501 chars -> 'Notes too long' error",
        "bun test:e2e passes with feedback form test",
        "bun run typecheck passes"
      ]
    },
    {
      "id": "US-005",
      "title": "Create StarRating UI component",
      "status": "open",
      "dependsOn": [],
      "description": "As a developer, I want a reusable StarRating component so that feedback forms and idea details can display ratings consistently.",
      "acceptanceCriteria": [
        "Create src/components/ui/star-rating.tsx component",
        "Props: value (1-5), onChange? (callback), readonly (boolean), size (sm|md|lg)",
        "Render 5 star icons using lucide-react Star or StarHalf",
        "Readonly mode: Display filled stars up to value, empty stars for rest",
        "Interactive mode: Stars clickable, hover preview, onClick calls onChange(rating)",
        "Size variants: sm (16px), md (24px), lg (32px)",
        "Keyboard navigation: Arrow keys to change rating, Enter to select",
        "ARIA attributes: role='slider', aria-valuemin, aria-valuemax, aria-valuenow",
        "Accessible: Focus visible, screen reader announces rating",
        "Example: <StarRating value={4} readonly /> -> shows 4 filled, 1 empty",
        "Example: Click 3rd star in interactive mode -> onChange(3) called",
        "bun test:e2e passes with keyboard navigation test",
        "Component used in FeedbackForm and IdeaDetail"
      ]
    },
    {
      "id": "US-006",
      "title": "Edit idea and move between topics",
      "status": "open",
      "dependsOn": ["US-001"],
      "description": "As a user, I want to edit an idea's details and move it to a different topic so that I can reorganize my content.",
      "acceptanceCriteria": [
        "Create /ideas/:id/edit route with pre-filled form",
        "Form fields: topic dropdown, name, description, tags",
        "Topic dropdown shows all non-archived topics (fetch from /api/topics)",
        "Pre-select current topic in dropdown",
        "Name and description pre-filled with existing values",
        "Tags pre-populated with existing tags (use useTagInput hook)",
        "Tag input with autocomplete showing existing tags",
        "Validation: Topic and name required (show errors if missing)",
        "On submit: Call PUT /api/ideas/:id with updated fields",
        "Send X-API-Key header from localStorage",
        "Redirect to /ideas/:id on successful update",
        "Handle error: Display error message from API",
        "Loading state during submit (disable submit button)",
        "Example: Change topic from 'AI Ideas' to 'Business Ideas', save -> redirects to detail page",
        "Example: Update name and add new tag, save -> changes reflected in detail page",
        "Negative case: Submit without name -> 'Name is required' error",
        "Negative case: Invalid idea ID -> 404 error page",
        "Tag sync uses shared tag processing logic (no duplication)",
        "bun test:e2e passes with edit idea test",
        "bun run typecheck passes"
      ]
    },
    {
      "id": "US-007",
      "title": "Create update idea API endpoint",
      "status": "open",
      "dependsOn": ["US-001"],
      "description": "As a developer, I want an API endpoint to update ideas so that users can edit idea details and change topics.",
      "acceptanceCriteria": [
        "Create PUT /api/ideas/:id endpoint",
        "Validate request body with zod schema: { topicId: string, name: string, description?: string, tags?: string[] }",
        "Check if idea exists (404 if not found)",
        "Check if idea is archived (404 if archived)",
        "Check if new topic exists and is not archived (400 if invalid)",
        "Update idea.name, idea.description, idea.topicId, idea.updatedAt",
        "Sync tags: Remove tags not in list, add new tags, link all tags",
        "Use shared tag processing logic (extract to helper function)",
        "Return updated idea with all fields",
        "Require valid API key (X-API-Key header)",
        "Example: Update idea with new topicId -> idea moved to new topic",
        "Example: Update idea with new tags -> old tags removed, new tags added",
        "Negative case: Update with invalid topicId -> 400 'Topic not found'",
        "Negative case: Update archived idea -> 404 'Idea not found'",
        "Add 4 tests for update logic, tag sync, validation",
        "bun test passes, bun run typecheck passes"
      ]
    },
    {
      "id": "US-008",
      "title": "Delete idea with soft delete",
      "status": "open",
      "dependsOn": ["US-002"],
      "description": "As a user, I want to delete an idea so that I can remove content I no longer need.",
      "acceptanceCriteria": [
        "Add 'Delete Idea' button on idea detail page (destructive style)",
        "Clicking delete shows confirmation modal with idea name",
        "Modal message: 'Are you sure you want to delete \"X\"? This will archive the idea.'",
        "Modal has Cancel and Confirm buttons",
        "On confirm: Call DELETE /api/ideas/:id",
        "Send X-API-Key header from localStorage",
        "API sets idea.isArchived = 1, updates idea.updatedAt",
        "On success: Navigate to parent topic page (/topics/:id)",
        "On error: Display error message, keep modal open",
        "Loading state during delete (disable buttons, show 'Deleting...')",
        "Example: Delete idea -> navigates to topic page, idea not visible",
        "Negative case: Try to view deleted idea -> 404 'Idea not found'",
        "bun test:e2e passes with delete idea test",
        "bun run typecheck passes"
      ]
    },
    {
      "id": "US-009",
      "title": "Create delete idea API endpoint",
      "status": "open",
      "dependsOn": ["US-001"],
      "description": "As a developer, I want an API endpoint to soft delete ideas so that deleted ideas are archived but not permanently removed.",
      "acceptanceCriteria": [
        "Create DELETE /api/ideas/:id endpoint",
        "Check if idea exists (404 if not found)",
        "Check if idea is already archived (400 if already archived)",
        "Set idea.isArchived = 1, idea.updatedAt = now",
        "Return { success: true }",
        "Require valid API key (X-API-Key header)",
        "Example: DELETE /api/ideas/:id -> idea.isArchived = 1",
        "Negative case: DELETE non-existent idea -> 404 'Idea not found'",
        "Negative case: DELETE archived idea -> 400 'Idea is already archived'",
        "Add 3 tests for success, 404, 400 cases",
        "bun test passes, bun run typecheck passes"
      ]
    },
    {
      "id": "US-010",
      "title": "Fix N+1 query - Tag fetching with subqueries",
      "status": "open",
      "dependsOn": [],
      "description": "As a developer, I want to optimize tag fetching queries so that API responses are fast even with many items.",
      "acceptanceCriteria": [
        "Remove correlated subqueries in GROUP_CONCAT from all GET endpoints",
        "Affected endpoints: /api/topics, /api/topics/:id, /api/ideas/:id, /api/archive/topics, /api/ideas",
        "Use separate tag query with LEFT JOIN or JSON aggregation",
        "Option A: Fetch tags in separate query, join in application code",
        "Option B: Use JSON_GROUP_OBJECT if SQLite supports it",
        "Option C: Use CTE (Common Table Expression) to fetch tags once",
        "Measure query time before and after (should be < 50ms with 100 items)",
        "Ensure all existing tests still pass",
        "Add performance test: Query 100 topics + ideas, verify < 200ms",
        "Example: GET /api/topics with 50 topics -> returns in < 100ms",
        "Example: GET /api/topics/:id with 20 ideas -> returns in < 50ms",
        "No regressions: All 43 existing tests pass",
        "bun test passes, bun run typecheck passes"
      ]
    },
    {
      "id": "US-011",
      "title": "Fix N+1 query - Tag creation in loops",
      "status": "open",
      "dependsOn": [],
      "description": "As a developer, I want to optimize tag creation during POST operations so that creating items with many tags is fast.",
      "acceptanceCriteria": [
        "Replace loop-based tag creation in POST /api/topics and POST /api/ideas",
        "Current: For each tag, check exists -> insert -> link (3n queries)",
        "New: Bulk INSERT OR IGNORE for all tags, then bulk INSERT for links",
        "Use transaction to ensure atomicity",
        "Extract shared tag processing logic to helper function in src/lib/tags.ts",
        "Function signature: processTags(db, tags, entityId, entityType)",
        "Measure time: Creating topic with 10 tags should be < 50ms",
        "Example: POST /api/topics with 5 tags -> 1 query for tags, 1 for links",
        "Example: POST /api/ideas with 10 tags -> completes in < 50ms",
        "All existing tests pass (no behavior changes)",
        "Add performance test for tag creation",
        "bun test passes, bun run typecheck passes"
      ]
    },
    {
      "id": "US-012",
      "title": "Create shared Sidebar component",
      "status": "open",
      "dependsOn": [],
      "description": "As a developer, I want to extract duplicated sidebar code into a shared component so that navigation is consistent and maintainable.",
      "acceptanceCriteria": [
        "Create src/components/layout/Sidebar.tsx component",
        "Accept children prop for main content",
        "Sidebar includes: App title, navigation links (Home, Archive, Settings), branding/footer",
        "Responsive: Hidden on mobile (lg:block), bottom nav on mobile",
        "Styling: w-64, border-r, bg-muted/40, p-6",
        "Navigation links use React Router Link with active state styling",
        "Active link: highlighted with different bg/border",
        "Update all 7 components to use new Sidebar: Dashboard, TopicDetail, NewTopic, EditTopic, NewIdea, IdeaDetail, Archive",
        "Remove 200+ lines of duplicated sidebar code",
        "Example: Dashboard wraps content in <Sidebar><Dashboard /></Sidebar>",
        "Example: Clicking navigation link updates route and highlights active link",
        "Mobile: Sidebar hidden, show bottom nav bar with icons",
        "bun test:e2e passes with navigation test",
        "bun run typecheck passes"
      ]
    },
    {
      "id": "US-013",
      "title": "Create shared Layout wrapper component",
      "status": "open",
      "dependsOn": ["US-012"],
      "description": "As a developer, I want a Layout component that combines sidebar with main content area so that page structure is consistent.",
      "acceptanceCriteria": [
        "Create src/components/layout/Layout.tsx component",
        "Props: title (string), actions (React node for header buttons), children",
        "Layout structure: Sidebar (left), main content area (right)",
        "Main content: Header with title + actions, content div with p-6/p-8",
        "Header: h1 title on left, actions (buttons, etc) on right",
        "Responsive: Full width on mobile, max-w-6xl on desktop",
        "Update components to use Layout: Dashboard, TopicDetail, Archive, etc.",
        "Example: <Layout title='Dashboard' actions={<NewTopicButton />}>content</Layout>",
        "Example: NewTopic uses Layout with 'New Topic' title, no actions",
        "Eliminates header duplication across components",
        "bun test:e2e passes, bun run typecheck passes"
      ]
    },
    {
      "id": "US-014",
      "title": "Extract useTagInput custom hook",
      "status": "open",
      "dependsOn": [],
      "description": "As a developer, I want to extract tag input logic into a custom hook so that tag functionality is consistent and not duplicated.",
      "acceptanceCriteria": [
        "Create src/hooks/useTagInput.ts hook",
        "Parameters: initialTags (string[]), allTags (string[])",
        "Returns: tags (string[]), tagInput (string), setTagInput, handleAddTag, handleRemoveTag, filteredTags, showAutocomplete",
        "handleAddTag: Adds tag if not empty, not duplicate, clears input",
        "handleRemoveTag: Removes tag by index",
        "filteredTags: allTags filtered to exclude already-added tags (case-insensitive)",
        "showAutocomplete: tagInput not empty and filteredTags.length > 0",
        "Enter key calls handleAddTag if tagInput not empty",
        "Update NewTopic, EditTopic, NewIdea, EditIdea to use hook",
        "Remove 150+ lines of duplicated tag logic",
        "Example: In NewTopic, const { tags, handleAddTag, filteredTags } = useTagInput([], allTags)",
        "Example: Typing 'tech' shows existing tags matching 'tech', excludes already-added",
        "bun test:e2e passes with tag input test",
        "bun run typecheck passes"
      ]
    },
    {
      "id": "US-015",
      "title": "Break down Archive component into smaller modules",
      "status": "open",
      "dependsOn": ["US-012", "US-013"],
      "description": "As a developer, I want to refactor the 724-line Archive component into smaller components so that it's maintainable and testable.",
      "acceptanceCriteria": [
        "Extract ArchiveFilterBar component (search, tag filter, type filter, clear button)",
        "Extract ArchiveItemList component (list of ArchiveItemCard)",
        "Extract RestoreConfirmationDialog component",
        "Extract DeleteConfirmationDialog component",
        "Create useArchiveFilters hook (search, tags, type state, URL sync)",
        "Create useArchiveActions hook (restore, delete API calls)",
        "Archive.tsx reduced to < 200 lines (composition + data fetching)",
        "ArchiveFilterBar: Search input, tag chips, type dropdown, clear button",
        "ArchiveItemList: Maps items to cards, empty state, loading state",
        "Dialogs: Reusable components with open/close state, confirmation logic",
        "All components in src/components/archive/ directory",
        "Example: Archive.tsx imports components, composes layout",
        "Example: ArchiveFilterBar calls onSearchChange callback",
        "bun test:e2e passes with archive test",
        "bun run typecheck passes"
      ]
    },
    {
      "id": "US-016",
      "title": "Extract API routes to separate modules",
      "status": "open",
      "dependsOn": [],
      "description": "As a developer, I want to extract API routes from index.ts into separate modules so that the codebase is modular and maintainable.",
      "acceptanceCriteria": [
        "Create src/api/topics.ts with GET /api/topics, POST /api/topics, GET /api/topics/:id, PUT /api/topics/:id, DELETE /api/topics/:id",
        "Create src/api/ideas.ts with POST /api/ideas, GET /api/ideas/:id, PUT /api/ideas/:id, DELETE /api/ideas/:id, POST /api/ideas/:id/feedback",
        "Create src/api/archive.ts with GET /api/archive/topics, GET /api/archive/ideas, POST restore endpoints, DELETE permanent-delete endpoints",
        "Create src/api/tags.ts with GET /api/tags",
        "Create src/api/search.ts with GET /api/search",
        "Create src/api/export.ts with GET /api/export",
        "Create src/api/import.ts with POST /api/import",
        "Create src/api/routes.ts that registers all routes with Bun.serve",
        "Move SQL queries to src/queries/ directory (topics.sql, ideas.sql, etc.)",
        "Update src/index.ts to import and use routes from routes.ts",
        "src/index.ts reduced to server setup only (< 100 lines)",
        "Example: routes.ts imports topicRoutes, ideaRoutes, etc., adds to routes object",
        "Example: src/api/topics.ts imports db from lib/db, exports route handlers",
        "All 43 existing tests pass (no behavior changes)",
        "bun test passes, bun run typecheck passes"
      ]
    },
    {
      "id": "US-017",
      "title": "Implement global text search",
      "status": "open",
      "dependsOn": ["US-001"],
      "description": "As a user, I want to search topics and ideas by text so that I can quickly find specific content.",
      "acceptanceCriteria": [
        "Create /search route with search page UI",
        "Add search input in header (persistent, auto-focus on page load)",
        "Debounce search input (300ms) to avoid excessive queries",
        "Create GET /api/search endpoint with ?q= query parameter",
        "Search queries topics and ideas by name and description (case-insensitive)",
        "Use SQL LIKE pattern matching: %searchterm%",
        "Return combined results with type discriminator (topic/idea)",
        "Results sorted by relevance (name match first, then description match)",
        "Show result count: 'X results for \"searchterm\"'",
        "Search results page displays cards with type badge, name, description snippet, tags",
        "Clicking result navigates to detail page (/topics/:id or /ideas/:id)",
        "Empty state: 'No results for \"searchterm\"'",
        "Loading state: Show skeleton cards while fetching",
        "Example: Search 'startup' -> returns topics/ideas with 'startup' in name/description",
        "Example: Type 'ai' -> wait 300ms -> fetch results -> display 5 cards",
        "Negative case: Search 'xyz' with no matches -> 'No results' message",
        "Send X-API-Key header with request",
        "Add 3 tests for search logic (topics only, ideas only, both)",
        "bun test:e2e passes with search test",
        "bun run typecheck passes"
      ]
    },
    {
      "id": "US-018",
      "title": "Add tag filtering with multi-select",
      "status": "open",
      "dependsOn": ["US-017"],
      "description": "As a user, I want to filter search results by tags so that I can narrow down to specific content.",
      "acceptanceCriteria": [
        "Add tag filter section to /search page (below search input)",
        "Display all available tags as clickable chips/badges with counts",
        "Support multi-select: Click tag to toggle (selected state highlighted)",
        "Filter logic: Show items matching ALL selected tags (AND logic)",
        "Query parameter: ?tags=tag1,tag2 (comma-separated)",
        "Update URL on tag selection (preserves search query)",
        "Clear tags button to reset filter",
        "Tag counts update based on current search results",
        "Selected tags persist in URL (shareable, back button works)",
        "GET /api/search accepts &tags=tag1,tag2 query parameter",
        "API filters results to include only items with all specified tags",
        "Example: Select 'ai' and 'tech' tags -> shows only items tagged with both",
        "Example: Click tag chip -> URL updates to ?tags=ai, results filter immediately",
        "Example: Click tag again -> deselects, URL updates, results expand",
        "Negative case: Select tag with no matching items -> 'No results' message",
        "Add 2 tests for tag filtering (single tag, multiple tags)",
        "bun test:e2e passes with tag filter test",
        "bun run typecheck passes"
      ]
    },
    {
      "id": "US-019",
      "title": "Add rating filter to search",
      "status": "open",
      "dependsOn": ["US-017"],
      "description": "As a user, I want to filter ideas by feedback rating so that I can prioritize based on quality.",
      "acceptanceCriteria": [
        "Add rating filter dropdown to /search page (below tag filter)",
        "Dropdown options: 5 stars, 4+ stars, 3+ stars, 2+ stars, 1+ stars, Any",
        "Filter logic: Show ideas with rating >= selected threshold",
        "Query parameter: ?rating=4 (shows ideas with rating 4 or 5)",
        "Update URL on rating selection (preserves search + tags)",
        "Ideas without feedback excluded from rating filters (unless 'Any' selected)",
        "GET /api/search accepts &rating=4 query parameter",
        "API filters ideas where feedback.rating >= rating value",
        "Rating filter only applies to ideas (topics not filtered by rating)",
        "Example: Select '4+ stars' -> shows only ideas with rating 4 or 5",
        "Example: Search 'startup' + filter '5 stars' -> 5-star startup ideas",
        "Negative case: Select '5 stars' with no 5-star ideas -> 'No results'",
        "Add 2 tests for rating filtering (with rating, without feedback)",
        "bun test:e2e passes with rating filter test",
        "bun run typecheck passes"
      ]
    },
    {
      "id": "US-020",
      "title": "Add URL persistence to search filters",
      "status": "open",
      "dependsOn": ["US-017", "US-018", "US-019"],
      "description": "As a user, I want search filters to persist in URL so that I can share searches and use browser back button.",
      "acceptanceCriteria": [
        "Initialize search state from URL params on page mount",
        "URL params: ?q=searchterm&tags=tag1,tag2&rating=4",
        "Update URL params when filters change (use useSearchParams)",
        "Debounce search query updates (300ms) before URL update",
        "Tag and rating filters update URL immediately",
        "Browser back button restores previous filter state",
        "Shareable URL: Sending link to someone shows same filtered results",
        "Clear filters button removes all query params",
        "Example: Navigate to /search?q=startup&tags=ai -> shows filtered results",
        "Example: Change tags -> URL updates to ?q=startup&tags=ai,tech",
        "Example: Click back -> URL reverts to ?q=startup&tags=ai, results update",
        "Add 1 test for URL persistence (initialize from URL, update URL)",
        "bun test:e2e passes with URL test",
        "bun run typecheck passes"
      ]
    },
    {
      "id": "US-021",
      "title": "Create export data API endpoint",
      "status": "open",
      "dependsOn": ["US-001"],
      "description": "As a developer, I want an API endpoint to export all data as JSON so that users can backup their content.",
      "acceptanceCriteria": [
        "Create GET /api/export endpoint",
        "Query all topics (including archived) with tags",
        "Query all ideas (including archived) with tags, feedback, topicId",
        "Format data according to importFormat specification (version, exportedAt, topics array, ideas array)",
        "Set exportedAt to current ISO timestamp",
        "Include all fields: id, name, description, isArchived, tags, createdAt, updatedAt",
        "For ideas: Include feedback object (rating, notes) if exists",
        "Set Content-Type header to application/json",
        "Set Content-Disposition header to attachment; filename=ideas-export-YYYY-MM-DD.json",
        "Require valid API key (X-API-Key header)",
        "Example: GET /api/export -> downloads ideas-export-2026-01-20.json",
        "Example: Empty database -> valid JSON with topics: [], ideas: []",
        "Example: 3 topics, 10 ideas -> export includes all 13 items with tags",
        "Add 3 tests (export with data, export empty, structure validation)",
        "bun test passes, bun run typecheck passes"
      ]
    },
    {
      "id": "US-022",
      "title": "Create export button UI",
      "status": "open",
      "dependsOn": ["US-012"],
      "description": "As a user, I want an export button in the sidebar so that I can download my data.",
      "acceptanceCriteria": [
        "Add 'Export Data' link/button to sidebar (below Archive link)",
        "Clicking button calls GET /api/export with X-API-Key header",
        "Browser downloads JSON file with timestamp in filename",
        "Show loading state during export (spinner on button)",
        "Show success toast notification: 'Data exported successfully'",
        "Handle error: Display error message from API",
        "Button style: Outline variant with download icon (lucide-react Download)",
        "Example: Click export -> file downloads to Downloads folder",
        "Example: Export fails with 401 -> 'Unauthorized: Invalid API key' error",
        "bun test:e2e passes with export test",
        "bun run typecheck passes"
      ]
    },
    {
      "id": "US-023",
      "title": "Create import data API endpoint with validation",
      "status": "open",
      "dependsOn": ["US-001"],
      "description": "As a developer, I want an API endpoint to import data from JSON so that users can restore backups or migrate content.",
      "acceptanceCriteria": [
        "Create POST /api/import endpoint",
        "Accept multipart/form-data with file upload",
        "Validate file is .json (Content-Type application/json)",
        "Parse JSON and validate structure with zod schema",
        "Schema validation: version (number), exportedAt (string), topics (array), ideas (array)",
        "Validate required fields: topic.name (required, max 200), idea.topicId, idea.name (required, max 200)",
        "Validate feedback.rating (1-5), feedback.notes (max 500)",
        "If validation fails: Return 400 with detailed error messages per field",
        "If validation passes: Import data in transaction (topics first, then ideas, then feedback/tags)",
        "Check for duplicate IDs: Skip items with existing IDs (log warnings)",
        "Insert topics (if not exists), insert ideas (if not exists), link tags, insert feedback",
        "Return success response with counts: { topicsCreated, ideasCreated, topicsSkipped, ideasSkipped, errors }",
        "Require valid API key (X-API-Key header)",
        "Example: Import valid JSON with 5 topics, 20 ideas -> creates all items",
        "Negative case: Invalid JSON structure -> 400 'Invalid JSON format'",
        "Negative case: Missing required field -> 400 'Topic name is required'",
        "Negative case: Rating 6 -> 400 'Feedback rating must be 1-5'",
        "Add 5 tests (valid import, invalid JSON, missing fields, duplicate IDs, validation errors)",
        "bun test passes, bun run typecheck passes"
      ]
    },
    {
      "id": "US-024",
      "title": "Create import UI with drag-and-drop",
      "status": "open",
      "dependsOn": ["US-012"],
      "description": "As a user, I want an import page with file upload so that I can restore data from a backup.",
      "acceptanceCriteria": [
        "Create /settings/import route (or add to Settings page)",
        "Add file upload area with drag-and-drop support",
        "Drop zone styling: Dashed border, 'Drop JSON file here' text, changes on dragover",
        "File input: Accept .json files only, clickable to open file picker",
        "Show selected file name and size after selection",
        "Validate button triggers import (disabled until file selected)",
        "Loading state during import: Show progress spinner, 'Importing...' text",
        "Success state: Show summary toast with counts (X topics, Y ideas imported)",
        "Error state: Show detailed error messages (validation errors, API errors)",
        "Send X-API-Key header with request",
        "On success: Navigate to dashboard to see imported items",
        "Example: Drag file onto drop zone -> file selected, validate button enabled",
        "Example: Click import -> loading spinner -> success toast -> navigate to dashboard",
        "Negative case: Upload invalid JSON -> 'Invalid JSON format' error",
        "Negative case: Upload with missing fields -> 'Topic name is required' errors",
        "bun test:e2e passes with import test",
        "bun run typecheck passes"
      ]
    },
    {
      "id": "US-025",
      "title": "Implement singleton database connection",
      "status": "open",
      "dependsOn": [],
      "description": "As a developer, I want a singleton database connection so that we don't create multiple connection objects.",
      "acceptanceCriteria": [
        "Refactor src/lib/db.ts to use singleton pattern",
        "Create global database instance with let db: Database | null = null",
        "Export getDatabase() function that returns existing instance or creates new one",
        "Ensure only one Database object is created per application lifecycle",
        "Add database.close() cleanup function for graceful shutdown",
        "Update all imports to use getDatabase() (no changes needed if already using it)",
        "Verify only one connection is created (add counter or log for verification)",
        "Example: Import db from 10 files -> only 1 Database instance created",
        "Example: Call getDatabase() 5 times -> returns same instance each time",
        "Add 2 tests for singleton pattern (same instance, lazy initialization)",
        "bun test passes, bun run typecheck passes"
      ]
    },
    {
      "id": "US-026",
      "title": "Add zod validation schemas",
      "status": "open",
      "dependsOn": [],
      "description": "As a developer, I want zod validation schemas so that input validation is consistent and type-safe.",
      "acceptanceCriteria": [
        "Create src/lib/schemas.ts with zod schemas",
        "Create TopicSchema: { name: z.string().min(1).max(200), description: z.string().max(5000).optional(), tags: z.array(z.string().max(50)).optional() }",
        "Create IdeaSchema: { topicId: z.string().uuid(), name: z.string().min(1).max(200), description: z.string().max(5000).optional(), tags: z.array(z.string().max(50)).optional() }",
        "Create FeedbackSchema: { rating: z.number().int().min(1).max(5), notes: z.string().max(500).optional() }",
        "Create ExportSchema: Import format validation (version, topics, ideas arrays)",
        "Update API endpoints to use schemas for validation",
        "Use schema.parse() or schema.safeParse() for validation",
        "Return detailed error messages from zod validation errors",
        "Example: POST /api/topics with name '' -> zod error 'Name is required'",
        "Example: POST /api/ideas/:id/feedback with rating 6 -> 'Rating must be 1-5'",
        "Add 3 tests for schema validation (valid, invalid, edge cases)",
        "bun test passes, bun run typecheck passes"
      ]
    },
    {
      "id": "US-027",
      "title": "Standardize error handling patterns",
      "status": "open",
      "dependsOn": [],
      "description": "As a developer, I want consistent error handling so that UX is predictable and debugging is easier.",
      "acceptanceCriteria": [
        "Standardize on error: string | null pattern (not error: string)",
        "Update components using error: string to error: string | null",
        "Create useAsyncOperation hook for consistent error/loading states",
        "Hook returns: { data, error, isLoading, execute }",
        "Handle API errors consistently: Display error message from response",
        "Handle network errors: Display 'Network error, please try again'",
        "Handle validation errors: Display validation error messages",
        "Add global error boundary to catch React errors",
        "Error boundary shows 'Something went wrong' with reload button",
        "Example: API returns 400 -> { error: 'Invalid input' } stored in state",
        "Example: Network fails -> { error: 'Network error' } stored in state",
        "Example: React error -> error boundary catches it, shows fallback UI",
        "Update 5 components to use useAsyncOperation hook",
        "Add 2 tests for error boundary (throws error, recovers)",
        "bun test:e2e passes with error handling test",
        "bun run typecheck passes"
      ]
    },
    {
      "id": "US-028",
      "title": "Add React.memo to list item components",
      "status": "open",
      "dependsOn": [],
      "description": "As a developer, I want to memoize list item components so that re-renders are minimized.",
      "acceptanceCriteria": [
        "Wrap TopicCard component in Dashboard.tsx with React.memo",
        "Wrap IdeaCard component in TopicDetail.tsx with React.memo",
        "Wrap ArchiveItemCard component in Archive.tsx with React.memo",
        "Ensure components are pure (no side effects in render)",
        "Add custom comparison function if needed (avoid re-render on prop changes that don't affect output)",
        "Verify performance improvement with React DevTools Profiler",
        "Example: Filter changes in Archive -> IdeaCards don't re-render if props unchanged",
        "Example: Search query changes -> TopicCards don't re-render if not in results",
        "Add 1 test for memoization (verify component doesn't re-render)",
        "bun test:e2e passes, bun run typecheck passes"
      ]
    },
    {
      "id": "US-029",
      "title": "Create Settings page for API key configuration",
      "status": "open",
      "dependsOn": ["US-001"],
      "description": "As a user, I want a settings page to configure my API key so that I can authenticate with the backend.",
      "acceptanceCriteria": [
        "Create /settings route with settings page UI",
        "Add API key input field (password type, masked)",
        "Add 'Save API Key' button",
        "Store API key in localStorage on save",
        "Send X-API-Key header in all API requests from localStorage",
        "Show validation error if API key format is invalid",
        "Show success toast on save: 'API key saved'",
        "Add 'Test Connection' button to verify API key works",
        "Test Connection calls GET /api/hello with X-API-Key header",
        "Show success/error message based on test result",
        "Pre-fill input with existing API key from localStorage if present",
        "Example: Enter API key, click save -> stored in localStorage",
        "Example: Click test connection -> calls API, shows 'Connection successful'",
        "Example: Invalid key -> 'Connection failed: Unauthorized' error",
        "Add Settings link to sidebar",
        "bun test:e2e passes with settings test",
        "bun run typecheck passes"
      ]
    },
    {
      "id": "US-030",
      "title": "Clean up dead code and unused imports",
      "status": "open",
      "dependsOn": [],
      "description": "As a developer, I want to remove dead code so that the codebase is clean and bundle size is minimized.",
      "acceptanceCriteria": [
        "Remove src/components/APITester.tsx if unused",
        "Remove unused import in IdeaDetail.tsx (_navigate variable)",
        "Search for and remove any other unused imports or variables",
        "Enable noUnusedLocals and noUnusedParameters in tsconfig.json",
        "Fix all TypeScript unused variable warnings",
        "Run bun run typecheck to verify no unused variable errors",
        "Verify bundle size reduced (measure before/after with bun run build)",
        "Example: APITester.tsx removed from codebase",
        "Example: _navigate import removed from IdeaDetail.tsx",
        "bun test passes, bun run lint passes, bun run typecheck passes"
      ]
    },
    {
      "id": "US-031",
      "title": "Add comprehensive test coverage",
      "status": "open",
      "dependsOn": [],
      "description": "As a developer, I want 80%+ test coverage so that regressions are caught early.",
      "acceptanceCriteria": [
        "Run coverage report: bun test --coverage",
        "Identify files with < 80% coverage",
        "Add unit tests for uncovered functions/branches",
        "Focus on: API endpoints, validation schemas, helper functions",
        "Add integration tests for user flows (create topic, add idea, search, filter)",
        "Add E2E tests for critical paths (authentication, CRUD, import/export)",
        "Ensure all stories have corresponding tests",
        "Target: Minimum 80% coverage across all src/ files",
        "Example: Add tests for tag processing logic (US-011)",
        "Example: Add tests for search endpoint (US-017)",
        "Example: Add E2E test for complete import/export flow",
        "Verify coverage: bun test --coverage shows 80%+",
        "All tests pass: bun test, bun test:e2e",
        "bun run typecheck passes"
      ]
    },
    {
      "id": "US-032",
      "title": "Setup quality gates and CI validation",
      "status": "open",
      "dependsOn": ["US-031"],
      "description": "As a developer, I want automated quality gates so that code quality is maintained before merging.",
      "acceptanceCriteria": [
        "Ensure bun test runs and passes all tests",
        "Ensure bun test:e2e runs and passes all E2E tests",
        "Ensure bun run lint runs without errors (biome check)",
        "Ensure bun run typecheck runs without errors (tsc --noEmit)",
        "Ensure bun run build completes successfully",
        "Add pre-commit hook to run quality gates (optional)",
        "Add coverage threshold to package.json (test:coverage script)",
        "Document quality gates in CLAUDE.md or CONTRIBUTING.md",
        "Example: Run all gates -> bun test && bun test:e2e && bun run lint && bun run typecheck && bun run build",
        "Example: Failing test causes quality gate to fail with exit code 1",
        "Example: Type error caught by typecheck gate, blocks commit",
        "Add 1 test to verify quality gate scripts exist and run",
        "All quality gates pass: bun test, bun test:e2e, bun run lint, bun run typecheck, bun run build"
      ]
    }
  ]
}
